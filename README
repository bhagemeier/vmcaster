Vmcaster is a simple tool for managing and updating your published image lists.
It is based on a simple sql database, typically sqllight for storing image lists
and facard of uploaders so that image list updates can be done in a transfer 
protocol neutral way.

First get a image list:

wget https://dish.desy.de:2880/testing.smime  --no-check-certificate

Import it.

   python publisher.py   --imagelist-import-smime testing.smime 
INFO:main:Defaulting DB connection to 'sqlite:///dish.db'
(u'9b6fad19-d913-4cca-b77d-c4b4fcd9dc36', u'5f00fec3-4f2a-4fa0-a965-d52115606044')
(u'9b6fad19-d913-4cca-b77d-c4b4fcd9dc36', u'7b1aea46-8776-4447-9450-00e720fc042c')
WARNING:imagelistpub:making new.
WARNING:imagelistpub:making new.
WARNING:imagelistpub:making new.


   python publisher.py  --imagelist-list    

(u'9b6fad19-d913-4cca-b77d-c4b4fcd9dc36', u'5f00fec3-4f2a-4fa0-a965-d52115606044')
(u'9b6fad19-d913-4cca-b77d-c4b4fcd9dc36', u'7b1aea46-8776-4447-9450-00e720fc042c')


$python publisher.py --image-list  
INFO:main:Defaulting DB connection to 'sqlite:///dish.db'
5f00fec3-4f2a-4fa0-a965-d52115606044
7b1aea46-8776-4447-9450-00e720fc042c


Basic image list management
~~~~~~~~~~~~~~~~~~~~~~~~~~~

List endortsers,

   python publisher.py  --endorser-list

Show JSON for endorsers.

   python publisher.py   --endorser '/C=DE/O=GermanGrid/OU=DESY/CN=Owen Synge'  --endorser-show

Create an endorser 

   python publisher.py  --endorser-add "/C=DE/O=GermanGrid/OU=DESY/CN=Owen Synge"

Add Key pair for endorser.

   python publisher.py    --endorser "/C=DE/O=GermanGrid/OU=DESY/CN=Owen Synge"  \
      --endorser-key-set 'hv:email' --endorser-value 'owen.synge@desy.de' 

Create an image list.

   python publisher.py  --imagelist-add e38a3fd2-0ed8-11e2-873a-001cc0beb420

To display your image list.

   python publisher.py    --imagelist e38a3fd2-0ed8-11e2-873a-001cc0beb420  --imagelist-show

Binding endorser to an imagelist

   python publisher.py   --connect --endorser "/C=DE/O=GermanGrid/OU=DESY/CN=Owen Synge"  --imagelist 9b6fad19-d913-4cca-b77d-c4b4fcd9dc36

Unbinding endorser to an imagelist

   python publisher.py    --disconnect  --endorser "/C=DE/O=GermanGrid/OU=DESY/CN=Owen Synge"  --imagelist 9b6fad19-d913-4cca-b77d-c4b4fcd9dc36


Add attributes to an image list

   python publisher.py    --imagelist e38a3fd2-0ed8-11e2-873a-001cc0beb420 \
      --imagelist-key-set "dc:description"  \
      --imagelist-value  "DESY Image List SHaring service" 


To delete an Image:

   python publisher.py  --imagelist-del   --imagelist  9b6fad19-d913-4cca-b77d-c4b4fcd9dc36





To update an Image:
~~~~~~~~~~~~~~~~~~~

python publisher.py \
 --image-upload    /var/lib/libvirt/images/hudson-slave-vm06.desy.de.img \
 --image 7b1aea46-8776-4447-9450-00e720fc042c


What it should do. 
Check user is in database, 
Compresses file, 
uplaods it, 
bumps the image version number in the database.


python publisher.py  --endorser-show    --endorser '/C=DE/O=GermanGrid/OU=DESY/CN=Owen Synge'
{'hv:email': 'owen.synge@desy.de', 'dc:creator': 'Owen Synge', 'hv:ca': '/C=DE/O=GermanGrid/CN=GridKa-CA', 'hv:dn': '/C=DE/O=GermanGrid/OU=DESY/CN=Owen Synge'}


Shows the image list as it woudl be made.


python publisher.py  --imagelist 9b6fad19-d913-4cca-b77d-c4b4fcd9dc36  --imagelist-show      


# To update and sign image list.

python publisher.py  --imagelist 9b6fad19-d913-4cca-b77d-c4b4fcd9dc36  --update

# to update an image.


